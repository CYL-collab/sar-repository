<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible"/>
<meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport"/>
<title>Co-author Network</title>
<link href="../assets/img/kaiadmin/favicon.ico" rel="icon" type="image/x-icon"/>
<!-- Fonts and icons (Font Awesome via fonts.min.css) -->
<script src="../assets/js/plugin/webfont/webfont.min.js"></script>
<script>
    WebFont.load({
      google: { families: ["Public Sans:300,400,500,600,700"] },
      custom: {
        families: ["Font Awesome 5 Solid", "Font Awesome 5 Regular", "Font Awesome 5 Brands", "simple-line-icons"],
        urls: ["../assets/css/fonts.min.css"],
      },
      active: function () { sessionStorage.fonts = true; },
    });
  </script>
<!-- CSS Files -->
<link href="../assets/css/bootstrap.min.css" rel="stylesheet"/>
<link href="../assets/css/plugins.min.css" rel="stylesheet"/>
<link href="../assets/css/kaiadmin.min.css" rel="stylesheet"/>
<link href="../assets/repository.css" rel="stylesheet"/>
<link href="https://unpkg.com/vis-network/styles/vis-network.min.css" rel="stylesheet"/>
<style>html,body{height:100%;}#network{width:100%;height:720px;border:1px solid #ddd}.controls{margin-bottom:12px}.legend{font-size:13px}</style>
</head>
<body>
<div class="wrapper">
<!-- Sidebar fragment (reusable) -->
<div class="sidebar" data-background-color="dark">
<div class="sidebar-wrapper scrollbar scrollbar-inner">
<div class="sidebar-content">
<ul class="nav nav-secondary">
<li class="nav-section">
<span class="sidebar-mini-icon"><i class="fa fa-ellipsis-h"></i></span>
<h4 class="text-section">Papers</h4>
</li>
<li class="nav-item">
<a href="../index.html">
<i class="fas fa-home"></i>
<p>Home</p>
</a>
</li>
<li class="nav-item">
<a href="list.html">
<i class="fas fa-layer-group"></i>
<p>All Papers</p>
</a>
</li>
<li class="nav-section">
<span class="sidebar-mini-icon">
<i class="fa fa-ellipsis-h"></i>
</span>
<h4 class="text-section">Statistics (Under Construction)</h4>
<li class="nav-item active">
<a href="coauthor.html">
<i class="fas fa-file"></i>
<p>Co-author</p>
<span class="badge badge-secondary">1</span>
</a>
</li>
</li></ul>
</div>
</div>
</div>

<div class="main-panel"><div class="container"><div class="page-inner">
<h2 class="fw-bold mb-1">Co-author Network</h2>
<h6 class="op-7 mb-2" id="replace-description">Interactive co-authorship network</h6>
<div class="controls">
<input class="form-control" id="search" placeholder="Search author (partial name)" style="width:320px;display:inline-block;margin-right:8px"/>
<button class="btn btn-primary" id="btnSearch">Find</button>
<button class="btn btn-secondary" id="reset">Reset View</button>
<label style="margin-left:12px;display:inline-block;line-height:34px;margin-right:6px">Min coauthored edges:</label>
<input id="minEdge" min="1" style="width:80px;display:inline-block;margin-right:8px" title="Hide edges with weight less than this value" type="number" value="2"/>
<span class="legend float-end">Tip: click a node to highlight its neighbors</span>
</div>
<div id="network"></div>
</div></div></div>
</div>
<script src="../assets/js/core/jquery-3.7.1.min.js"></script>
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<script>
    const DATA_URL = '../assets/coauthor-preview.json';
    let network=null,nodes=null,edges=null,rawNodesAll=null,rawEdgesAll=null;
    function buildNetwork(data){
      const rawNodes=data.nodes||[];
      const rawEdges=data.edges||[];
      // store full raw arrays so we can re-filter when threshold changes
      rawNodesAll = rawNodes;
      rawEdgesAll = rawEdges;
      const minEdge = parseInt(document.getElementById('minEdge').value || '2', 10);
      // filter edges by weight >= minEdge
      const filteredEdges = rawEdges.filter(e => (e.weight||1) >= minEdge);
      // collect set of node ids that remain
      const nodeIds = new Set();
      filteredEdges.forEach(e=>{nodeIds.add(e.source); nodeIds.add(e.target)});
      // build vis nodes (only use name as label; do not show member counts)
      const visNodes = rawNodes
        .filter(n => nodeIds.size === 0 || nodeIds.has(n.id))
        .map(n => ({id:n.id, label:n.name, value: Math.max(1, Math.sqrt(n.size||1)), title: `${n.name}`}));
      const visEdges = filteredEdges.map((e, idx) => ({id:idx, from:e.source, to:e.target, width:Math.max(1, Math.log((e.weight||1)+1)*2), title:`coauthored: ${e.weight}`}));
      nodes=new vis.DataSet(visNodes);
      edges=new vis.DataSet(visEdges);
      const container=document.getElementById('network');
      const dataVis={nodes:nodes,edges:edges};
      const options={nodes:{shape:'dot',scaling:{min:6,max:40},font:{size:14}},edges:{color:{inherit:'from'},smooth:{type:'continuous'}},physics:{stabilization:true,barnesHut:{gravitationalConstant:-16000,springConstant:0.001}},interaction:{hover:true,tooltipDelay:100,multiselect:false}};
      // destroy previous network if present to allow re-create with new dataset
      if(network){try{network.destroy();}catch(e){} }
      network=new vis.Network(container,dataVis,options);
      network.on('click',function(params){
        if(!params.nodes||params.nodes.length===0){
          nodes.forEach(n=>nodes.update({id:n.id,color:undefined, font:{color:'#000'}}));
          edges.forEach(e=>edges.update({id:e.id,color:undefined}));
          return
        }
        const nodeId=params.nodes[0];
        const connected=network.getConnectedNodes(nodeId);
        nodes.forEach(n=>nodes.update({id:n.id,color:{background:'#ddd',border:'#aaa'},font:{color:'#666'}}));
        edges.forEach(e=>edges.update({id:e.id,color:{color:'#ddd'}}));
        nodes.update({id:nodeId,color:{background:'#ffcc00',border:'#b8860b'},font:{color:'#000'}});
        connected.forEach(cid=>nodes.update({id:cid,color:{background:'#ffe9b3'},font:{color:'#000'}}));
        // highlight connected edges
        visEdges.forEach((eObj, idx)=>{
          if((eObj.from===nodeId && connected.includes(eObj.to)) || (eObj.to===nodeId && connected.includes(eObj.from))){
            edges.update({id:idx,color:{color:'#f39c12'}})
          }
        })
      });
    }

    // Rebuild network when minEdge control changes
    function rebuildFromControl(){
      if(!rawNodesAll || !rawEdgesAll) return;
      try{
        buildNetwork({nodes: rawNodesAll, edges: rawEdgesAll});
      }catch(err){console.error('rebuild error', err)}
    }

    fetch(DATA_URL).then(r=>r.json()).then(data=>{buildNetwork(data)}).catch(err=>{document.getElementById('network').innerText='Failed to load co-author data: '+err;console.error(err)});
    document.addEventListener('DOMContentLoaded',function(){
      document.getElementById('btnSearch').addEventListener('click',function(){
        const q=document.getElementById('search').value.trim().toLowerCase();
        if(!q||!nodes) return;
        const matches=nodes.get().filter(n=>n.label.toLowerCase().includes(q));
        if(matches.length===0){alert('No match');return}
        network.selectNodes([matches[0].id]);
        network.focus(matches[0].id,{scale:1.2})
      });
      document.getElementById('reset').addEventListener('click',function(){if(network)network.fit()});
      // rebuild when minEdge changes (also on blur/enter)
      const minEdgeEl = document.getElementById('minEdge');
      if(minEdgeEl){
        minEdgeEl.addEventListener('change', rebuildFromControl);
        minEdgeEl.addEventListener('input', function(){ /* live update optional */ });
      }
    });
  </script>
</body>
</html>